<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pediatric &amp; Neonatal Weight-Based Medication Dosing Calculator</title>
    <meta name="description" content="ä»¥ mg/kg Ã— kg Ã· (mg/mL) è¨ˆç®—éœ€æŠ½ mL èˆ‡è‡³å°‘éœ€è¦å¹¾æ”¯è—¥ã€‚é©ç”¨æ–¼å…’ç«¥èˆ‡æ–°ç”Ÿå…’åŠ‘é‡æ›ç®—ã€‚" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ’‰</text></svg>">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 + ReactDOM (production) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- å¯é¸ï¼šè‹¥ä½ å“ªè£¡ä»ç”¨åˆ° type=numberï¼Œå¯ç”¨é€™æ®µéš±è—ä¸Šä¸‹ç®­é ­ï¼ˆä½†æœ¬æª”å·²å…¨æ”¹æˆ textï¼‰ -->
    <style>
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
      input[type="number"] { -moz-appearance: textfield; }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-b from-white to-slate-50 text-slate-900">
    <a class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white px-3 py-2 rounded-md border" href="#main">è·³è‡³ä¸»è¦å…§å®¹</a>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,env">
      const { useMemo, useState } = React;

      // -------- utils --------
      const roundN = (val, n) => {
        if (!Number.isFinite(val)) return 0;
        const f = Math.pow(10, n);
        return Math.round(val * f) / f;
      };

      // å°‡ä½¿ç”¨è€…è¼¸å…¥çš„å­—ä¸²è½‰ç‚ºã€Œéè² æ•¸å­—ã€ï¼Œéæ³•æˆ–ç©ºå­—ä¸²å›å‚³ 0ï¼ˆé¡¯ç¤ºä»ä¿ç•™ç‚ºç©ºï¼‰
      const toNonNegNumber = (s) => {
        if (typeof s !== "string") return 0;
        const t = s.trim().replace(",", "."); // å…è¨±å°æ•¸é»ç”¨é€—è™Ÿ
        if (t === "") return 0;
        const x = parseFloat(t);
        return Number.isFinite(x) && x >= 0 ? x : 0;
      };

      // ä»‹é¢å°å¡ï¼ˆæ”¯æ´ç´…å­— labelã€ç±³è‰²åº•ã€åŠ å¤§ç´…ç²—æ•¸å€¼ï¼‰
      function Stat({ label, value, mono, highlight = false, labelClass = "", bgClass = "bg-white" }) {
        const valueClass =
          (highlight ? "text-red-600 font-extrabold text-3xl md:text-4xl " : "text-lg font-semibold ") +
          (mono ? "font-mono " : "");
        return (
          <div className={`rounded-xl border border-slate-200 p-3 ${bgClass}`}>
            <div className={`text-xs ${labelClass || "text-slate-500"}`}>{label}</div>
            <div className={valueClass}>{value}</div>
          </div>
        );
      }

      function App() {
        // ä»¥å­—ä¸²ç•¶ stateï¼šå¯å®Œå…¨æ¸…ç©ºã€è‡ªç”±è¼¸å…¥
        const [doseMgPerKgStr, setDoseMgPerKgStr] = useState("0.01");
        const [weightKgStr, setWeightKgStr] = useState("30");
        const [totalMgPerVialStr, setTotalMgPerVialStr] = useState("150"); // æ¯æ”¯ç¸½é‡ (mg/æ”¯)
        const [vialVolumeMlStr, setVialVolumeMlStr] = useState("3");       // æ¯æ”¯å®¹é‡ (mL/æ”¯)
        const [decimalsStr, setDecimalsStr] = useState("2");

        // è§£æé¡¯ç¤ºç”¨å°æ•¸ä½æ•¸ï¼ˆé™åˆ¶ 0~4ï¼Œé è¨­ 2ï¼‰
        const decimals = useMemo(() => {
          const n = parseInt(decimalsStr, 10);
          if (!Number.isFinite(n)) return 2;
          return Math.max(0, Math.min(4, n));
        }, [decimalsStr]);

        const data = useMemo(() => {
          const d = toNonNegNumber(doseMgPerKgStr);
          const w = toNonNegNumber(weightKgStr);
          const mgPerVial = toNonNegNumber(totalMgPerVialStr);
          const vv = toNonNegNumber(vialVolumeMlStr);

          const totalMg = d * w; // mg
          const concMgPerMl = vv > 0 ? mgPerVial / vv : 0; // ç­‰æ•ˆæ¿ƒåº¦ mg/mL
          const totalMl = concMgPerMl > 0 ? totalMg / concMgPerMl : 0; // mL

          const vialsExact = vv > 0 ? totalMl / vv : 0;
          const vialsCeil = Math.ceil(vialsExact > 0 ? vialsExact : 0);
          const wholeVials = vv > 0 ? Math.floor(totalMl / vv) : 0;
          let remainderMl = totalMl - wholeVials * vv;
          if (remainderMl < 1e-9) remainderMl = 0;

          return { totalMg, totalMl, concMgPerMl, mgPerVial, vialsCeil, wholeVials, remainderMl, vv };
        }, [doseMgPerKgStr, weightKgStr, totalMgPerVialStr, vialVolumeMlStr]);

        // é€šç”¨ onChangeï¼šä¿æŒå­—ä¸²ï¼Œä¸é˜»æ“‹ä½¿ç”¨è€…è¼¸å…¥ï¼›è¨ˆç®—æ‰è½‰æ•¸å­—
        const onStr = (setter) => (e) => setter(e.target.value);

        return (
          <main id="main" className="mx-auto max-w-4xl px-4 py-8">
            <header className="mb-6">
  <h1 className="text-3xl md:text-4xl font-bold tracking-tight">
    Pediatric &amp; Neonatal
  </h1>

  {/* ç©ºä¸€è¡Œçš„è¦–è¦ºç•™ç™½ */}
  <div className="h-3 md:h-4"></div>

  <h2 className="text-xl md:text-2xl font-semibold tracking-tight">
    Weight-Based Medication Dosing Calculator
  </h2>

  {/* ä¸‹é¢é€™æ®µè‹¥åŸæœ¬æœ‰å°±ä¿ç•™ï¼Œèªªæ˜å…¬å¼ */}
  <p className="text-sm md:text-base text-slate-600 mt-2">
    é«”ç©(mL) = <span className="font-mono">[åŠ‘é‡(mg/kg) Ã— é«”é‡(kg)] Ã· ç­‰æ•ˆæ¿ƒåº¦(mg/mL)</span>ï¼Œ
    ç­‰æ•ˆæ¿ƒåº¦ = <span className="font-mono">æ¯æ”¯ç¸½é‡(mg) Ã· æ¯æ”¯å®¹é‡(mL)</span>ã€‚
  </p>
</header>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {/* Inputs */}
              <section aria-labelledby="inputs" className="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
                <h2 id="inputs" className="text-lg font-semibold mb-4">è¼¸å…¥åƒæ•¸</h2>
                <div className="space-y-4">
                  <div className="grid grid-cols-5 items-end gap-2">
                    <label className="col-span-3 text-sm text-slate-700">åŠ‘é‡ Dose</label>
                    <input
                      type="text" inputmode="decimal" aria-label="åŠ‘é‡ mg/kg"
                      value={doseMgPerKgStr} onChange={onStr(setDoseMgPerKgStr)}
                      className="col-span-3 md:col-span-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono"
                      placeholder="ä¾‹å¦‚ 0.01"
                    />
                    <div className="col-span-2 md:col-span-3 text-sm text-slate-500">mg/kg</div>
                  </div>

                  <div className="grid grid-cols-5 items-end gap-2">
                    <label className="col-span-3 text-sm text-slate-700">é«”é‡ Weight</label>
                    <input
                      type="text" inputmode="decimal" aria-label="é«”é‡ kg"
                      value={weightKgStr} onChange={onStr(setWeightKgStr)}
                      className="col-span-3 md:col-span-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono"
                      placeholder="ä¾‹å¦‚ 30"
                    />
                    <div className="col-span-2 md:col-span-3 text-sm text-slate-500">kg</div>
                  </div>

                  <div className="grid grid-cols-5 items-end gap-2">
                    <label className="col-span-3 text-sm text-slate-700">æ¯æ”¯ç¸½é‡ Total drug per vial</label>
                    <input
                      type="text" inputmode="decimal" aria-label="æ¯æ”¯ç¸½é‡ mg/æ”¯"
                      value={totalMgPerVialStr} onChange={onStr(setTotalMgPerVialStr)}
                      className="col-span-3 md:col-span-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono"
                      placeholder="ä¾‹å¦‚ 150ï¼ˆmg/æ”¯ï¼‰"
                    />
                    <div className="col-span-2 md:col-span-3 text-sm text-slate-500">mg/æ”¯</div>
                  </div>

                  <div className="grid grid-cols-5 items-end gap-2">
                    <label className="col-span-3 text-sm text-slate-700">æ¯æ”¯å®¹é‡ Vial volume</label>
                    <input
                      type="text" inputmode="decimal" aria-label="æ¯æ”¯å®¹é‡ mL/æ”¯"
                      value={vialVolumeMlStr} onChange={onStr(setVialVolumeMlStr)}
                      className="col-span-3 md:col-span-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono"
                      placeholder="ä¾‹å¦‚ 3ï¼ˆmL/æ”¯ï¼‰"
                    />
                    <div className="col-span-2 md:col-span-3 text-sm text-slate-500">mL/æ”¯</div>
                  </div>

                  <div className="grid grid-cols-5 items-end gap-2">
                    <label className="col-span-3 text-sm text-slate-700">é¡¯ç¤ºå°æ•¸ä½æ•¸</label>
                    <input
                      type="text" inputmode="numeric" aria-label="é¡¯ç¤ºå°æ•¸ä½æ•¸"
                      value={decimalsStr} onChange={onStr(setDecimalsStr)}
                      className="col-span-3 md:col-span-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono"
                      placeholder="0â€“4ï¼Œé è¨­ 2"
                    />
                    <div className="col-span-2 md:col-span-3 text-sm text-slate-500">ä½</div>
                  </div>

                  <div className="flex gap-2 pt-2">
                    <button
                      onClick={() => {
                        setDoseMgPerKgStr("0.01");
                        setWeightKgStr("30");
                        setTotalMgPerVialStr("150");
                        setVialVolumeMlStr("3");
                        setDecimalsStr("2");
                      }}
                      className="rounded-xl bg-slate-900 px-4 py-2 text-white shadow hover:bg-slate-800"
                    >
                      å¥—ç”¨ç¯„ä¾‹ï¼ˆ0.01 mg/kgï¼Œ30 kgï¼Œ150 mg/3 mLï¼‰
                    </button>
                    <button
                      onClick={() => {
                        setDoseMgPerKgStr("");
                        setWeightKgStr("");
                        setTotalMgPerVialStr("");
                        setVialVolumeMlStr("");
                        setDecimalsStr("2");
                      }}
                      className="rounded-xl border border-slate-300 bg-white px-4 py-2 text-slate-700 shadow-sm hover:bg-slate-50"
                    >
                      æ¸…ç©º
                    </button>
                  </div>
                </div>
              </section>

              {/* Results */}
              <section aria-labelledby="results" className="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
                <h2 id="results" className="text-lg font-semibold mb-4">çµæœ</h2>

                <div className="space-y-3 text-sm">
                  <div className="rounded-xl bg-slate-50 p-3">
                    <div className="font-medium">è¨ˆç®—å…¬å¼</div>
                    <div className="text-slate-700 mt-1 leading-relaxed">
                      é«”ç©(mL) ï¼ <span className="font-mono">[åŠ‘é‡(mg/kg) Ã— é«”é‡(kg)] Ã· ç­‰æ•ˆæ¿ƒåº¦(mg/mL)</span>
                    </div>
                    <div className="text-slate-700 mt-1 leading-relaxed">
                      ç­‰æ•ˆæ¿ƒåº¦(mg/mL) ï¼ <span className="font-mono">æ¯æ”¯ç¸½é‡(mg) Ã· æ¯æ”¯å®¹é‡(mL)</span>
                      {' '}= <span className="font-mono">{roundN(data.concMgPerMl, decimals).toFixed(decimals)} mg/mL</span>
                    </div>
                  </div>

                  {/* ç¬¬ä¸€åˆ—ï¼šé–‹å¹¾æ”¯ã€éœ€æŠ½é«”ç©ï¼ˆç´…å­—æ¨™ç±¤ï¼‹ç±³è‰²åº•ï¼‹å¤§ç´…ç²—æ•¸å€¼ï¼‰ */}
                  <div className="grid grid-cols-2 gap-3">
                    <Stat
                      label="è‡³å°‘éœ€è¦é–‹å¹¾æ”¯"
                      value={data.vialsCeil}
                      highlight
                      labelClass="text-red-700"
                      bgClass="bg-amber-50"
                    />
                    <Stat
                      label="éœ€æŠ½é«”ç© (mL)"
                      value={roundN(data.totalMl, decimals).toFixed(decimals)}
                      mono
                      highlight
                      labelClass="text-red-700"
                      bgClass="bg-amber-50"
                    />

                    {/* ç¬¬äºŒåˆ—ï¼šå…¶é¤˜ç¶­æŒåŸæ¨£ */}
                    <Stat
                      label="ç¸½åŠ‘é‡ (mg)"
                      value={roundN(data.totalMg, decimals).toFixed(decimals)}
                      mono
                    />
                    <Stat
                      label="æ¯æ”¯ç¸½å«é‡ (mg)"
                      value={roundN(data.mgPerVial, decimals).toFixed(decimals)}
                      mono
                    />
                  </div>

                  <hr className="border-slate-200 my-2" />

                  <div>
                    <div className="font-medium mb-1">æŠ½è—¥å»ºè­°</div>
                    {data.vialsCeil === 0 ? (
                      <p className="text-slate-600">â€”</p>
                    ) : (
                      <ol className="list-decimal pl-5 space-y-1 text-slate-700">
                        {Array.from({ length: data.wholeVials }).map((_, i) => (
                          <li key={i}>ç¬¬ {i + 1} æ”¯ï¼šæŠ½ {roundN(data.vv, decimals).toFixed(decimals)} mL</li>
                        ))}
                        {data.remainderMl > 0 && (
                          <li>ç¬¬ {data.vialsCeil} æ”¯ï¼šæŠ½ {roundN(data.remainderMl, decimals).toFixed(decimals)} mL</li>
                        )}
                      </ol>
                    )}
                    {data.vialsCeil > 0 && (
                      <p className="mt-2 text-xs text-slate-500">
                        â€» ä»¥ä¸Šä»¥å‘ä¸Šå–æ•´è¨ˆç®—è‡³å°‘éœ€è¦é–‹ {data.vialsCeil} æ”¯ï¼Œå¯¦éš›æŠ½å–é«”ç©åˆè¨ˆç‚º {roundN(data.totalMl, decimals).toFixed(decimals)} mLï¼ˆ{roundN(data.totalMg, decimals).toFixed(decimals)} mgï¼‰ã€‚
                      </p>
                    )}
                  </div>

                  {(toNonNegNumber(totalMgPerVialStr) === 0 || toNonNegNumber(vialVolumeMlStr) === 0) && (
                    <div className="rounded-xl bg-amber-50 border border-amber-200 p-3 text-amber-800 text-xs">
                      è«‹è¼¸å…¥æœ‰æ•ˆçš„ã€Œæ¯æ”¯ç¸½é‡ (mg/æ”¯)ã€èˆ‡ã€Œæ¯æ”¯å®¹é‡ (mL/æ”¯)ã€ä»¥å®Œæˆè¨ˆç®—ã€‚
                    </div>
                  )}
                </div>
              </section>
            </div>

            <footer className="mt-6 text-xs text-slate-500">
              Â© 2025 â€” åƒ…ä¾›æ•™å­¸èˆ‡è¼”åŠ©è¨ˆç®—ï¼›è‡¨åºŠè™•ç½®è«‹ä¾é†«å›‘èˆ‡é™¢å…§è¦ç¯„é›™äººæŸ¥æ ¸ã€‚
            </footer>
          </main>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
